<?xml version="1.0" encoding="UTF-8"?>

<beans:beans xmlns="http://www.springframework.org/schema/security"
	xmlns:beans="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
 		http://www.springframework.org/schema/beans
 		http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
		http://www.springframework.org/schema/security
		http://www.springframework.org/schema/security/spring-security.xsd">

	<!-- Spring Security -->

	<!-- <http> <csrf disabled="true" /> <intercept-url pattern="/welcome" access="permitAll"></intercept-url> 
		<intercept-url pattern="/login" access="permitAll"></intercept-url> <intercept-url 
		pattern="/registration" access="permitAll"></intercept-url> <intercept-url 
		pattern="/**" access="hasRole('ROLE_USER')"></intercept-url> <form-login 
		login-page="/login" default-target-url="/home" authentication-failure-url="/login?login_error=1"></form-login> 
		<logout logout-success-url="/logout"></logout> </http> -->

	<beans:bean id="springSecurityFilterChain"
		class="org.springframework.security.web.FilterChainProxy">
		<filter-chain-map request-matcher="ant">

			<filter-chain pattern="/**"
				filters="
				usernamePasswordAuthenticationFilter,
				filterSecurityInterceptor" />

		</filter-chain-map>
	</beans:bean>

	<authentication-manager id="authenticationManager">
		<authentication-provider user-service-ref="accountService">
			<password-encoder ref="bcryptEncoder" />
		</authentication-provider>
	</authentication-manager>

	<beans:bean id="bcryptEncoder"
		class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder" />

	<beans:bean id="usernamePasswordAuthenticationFilter"
		class="org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter">
		<beans:property name="authenticationManager" ref="authenticationManager" />
		<beans:property name="authenticationSuccessHandler"
			ref="authenticationSuccessHandler" />
		<beans:property name="filterProcessesUrl" value="/login_post" />
	</beans:bean>

	<beans:bean id="filterSecurityInterceptor"
		class="org.springframework.security.web.access.intercept.FilterSecurityInterceptor">
		<beans:property name="authenticationManager" ref="authenticationManager" />
		<beans:property name="accessDecisionManager" ref="accessDecisionManager" />
		<beans:property name="securityMetadataSource">
			<filter-security-metadata-source>
				<intercept-url pattern="/home" access="hasRole('USER')" />
			</filter-security-metadata-source>
		</beans:property>
	</beans:bean>

	<beans:bean id="accessDecisionManager"
		class="org.springframework.security.access.vote.UnanimousBased">
		<beans:constructor-arg>
			<beans:list>
				<beans:bean class="org.springframework.security.access.vote.RoleVoter" />
				<beans:bean
					class="org.springframework.security.web.access.expression.WebExpressionVoter" />
			</beans:list>
		</beans:constructor-arg>
	</beans:bean>

	<beans:bean id="authenticationSuccessHandler"
		class="de.canberk.webapp.handler.CustomAuthenticationSuccessHandler" />

</beans:beans>